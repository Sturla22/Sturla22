---
layout: post
title: Doxygen for VHDL
tags:
    - VHDL
    - Tools
---
{% assign listing_num = 1 %}

Doxygen is the industry standard in SW development for auto-generating documentation from code. It works pretty well for VHDL, I'll cover the basics, share some tips and tricks and provide a few warnings in this post.

{% include toc.html %}

## Basics

Generate a base Doxyfile with `doxygen -g Doxyfile`

Set `OPTIMIZE_OUTPUT_VHDL` to YES in the Doxyfile.

## Documenting for Doxygen
Use `--!` comments to include your documentation in the docs generated by Doxygen. Beware that any regular `--` comment within a block of Doxygen comments will split the blocks in two.

```vhdl
--! \file testbench.vhdl
-- <--- oops, missing exclamation mark
--! \author Oh no separate block!
```

An index of Doxygen's `\commands` (which can also be `@commands`) can be found [here](https://www.doxygen.nl/manual/commands.html).

Here is an example from <https://github.com/Sturla22/pltbutils/tree/doxygen>:

<figure class="image" id="{{ "doxygen-example" | slugify }}">
  <figcaption style="text-align: right;"><a style="color: inherit; text-decoration: underline;" href="#{{ "doxygen-example" | slugify }}">doxygen-example</a></figcaption>
{% highlight vhdl linenos %}
--! \overload
--!
--! \param num               Test number. Optional, default is to increment
--!                          the current test number.
--! \param name              Test name.
--!
--! \param pltbv, pltbs      PlTbUtils' status- and control variable and
--!                          -signal.
--!
--! If the test number is omitted, a new test number is automatically
--! computed by incrementing the current test number.
--! Manually setting the test number may make it easier to find the test code
--! in the testbench code, though.
--!
--! **Examples**
--! ```vhdl
--! starttest(1, "Reset test", pltbv, pltbs);
--! ```
procedure starttest(
  constant num                : in    integer := -1;
  constant name               : in    string;
  variable pltbv              : inout pltbv_t;
  signal   pltbs              : out   pltbs_t
);
{% endhighlight %}
  <figcaption style="padding: 0.5rem 10px; font-size: unset;"><strong>Listing {{ listing_num }}</strong>: Doxygen Example</figcaption>
</figure>

The result is [this](https://sturla22.github.io/pltbutils/classpltbutils__func__pkg.html#a1792f8d6957cc29f2bdf372166bcce67) representation of the procedure starttest:

![starttest result](/assets/img/doxygen_starttest_result.png)

## Configuring Doxygen

If you want to hit the ground running you can set `EXTRACT_ALL` to YES and Doxygen will generate documentation based on code and not only on the code that has been documented with `--!` comments. Another setting to ensure you get as much documentation as fast as possible is `RECURSIVE` which you also want to set to YES so that Doxygen will go through all subdirectories to find your code.

For graphical representations of the code's hierarchy I set `UML_LOOK` to YES and I found `COLLABORATION_GRAPH` to be too noisy for VHDL, so I set that to NO. `DOT_IMAGE_FORMAT = svg` is handy when you have large hierarchies since you can zoom and pan around, setting `INTERACTIVE_SVG` to YES also increases the usefulness of the graphics since it enables you to traverse the hierarchy by clicking around in the graphics. If Doxygen does not generate graphics, check the `HAVE_DOT` setting and it's documentation.

Click on 'Expand Doxyfile diff' below for an example of the changes I made to the default generated Doxyfile when preparing to generate <https://sturla22.github.io/pltbutils>

<details>
<summary style="font-size: larger">Expand Doxyfile diff</summary>
<p>

{% highlight diff %}
{% include_relative includes/doxygen-for-vhdl/doxyfile_diff.txt %}
{% endhighlight %}

</p>
</details>

## Issues related to documenting VHDL with Doxygen

- Since VHDL does not have multiline comments one needs to be careful about including a `!` after every `--` in the documentation blocks that Doxygen is supposed to parse, otherwise the documentation blocks will be split and the results will not match your intention.
- Problem with procedures that have file interface parameters: <https://github.com/doxygen/doxygen/issues/8450>
- The `\code` and `\endcode` seem to cause the entire documentation block to disappear: <https://github.com/doxygen/doxygen/issues/8231>

  In my experience using the following snippet works well as a replacement.
  ````
  --! ```vhdl
  --! insert code here...
  --! ```
  ````
  You can replace vhdl in that snippet with another language like python or tcl.

If you run into other issues, take a look at [Doxygen's issue tracker](https://github.com/doxygen/doxygen/issues?q=is%3Aissue+is%3Aopen+label%3AVHDL+) in case there are known workarounds.


## Conclusion

Doxygen is a useful tool in the VHDL toolbox, even though there are some issues at the moment, but that is the beauty of open source software: we can influence the development of these applications and in case we don't get the response we hoped for we can take matters into our own hands!
